
USE MASTER 

IF DB_ID('TorneosDBS') IS NOT NULL
 DROP DATABASE TorneosDBS
GO

CREATE DATABASE TorneosDBS
GO

CREATE TABLE BD_LIGA_DANIELbRICEÑO (
    COD_LIGA CHAR(10) PRIMARY KEY,
    LIGA VARCHAR(100)
);
GO
CREATE TABLE BD_TORNEO_DANIELbRICEÑO  (
    COD_BOLETA CHAR(10) PRIMARY KEY,
    FECHA DATE,
    COD_LIGA CHAR(10),
    NOMBRE_ORGANIZADOR VARCHAR(100),
    CELULAR VARCHAR(20),
    CORREO VARCHAR(100),
    FOREIGN KEY (COD_LIGA) REFERENCES BD_LIGA_DANIELbRICEÑO(COD_LIGA)
);
GO
CREATE TABLE  BD_DICIPLINA_DANIELbRICEÑO (
    COD_DICIPLINA_PARTIC CHAR(10) PRIMARY KEY,
    DICIPLINA_PARTICIPANTE VARCHAR(100)
);
GO


-- Crear la tabla PARTICIPANTES
CREATE TABLE  BD_PARTICIPANTES_DANIELbRICEÑO (
    COD_BOLETA CHAR(10),
    COD_NOMBRE_PARTCIPANTE CHAR(10),
    CARRERA_PARTICIPANTE VARCHAR(100),
    COD_DICIPLINA_PARTIC CHAR(10),
    MEDALLAS_GANADAS INT,
    PRIMARY KEY (COD_BOLETA, COD_NOMBRE_PARTCIPANTE),
    FOREIGN KEY (COD_DICIPLINA_PARTIC) REFERENCES BD_DICIPLINA_DANIELbRICEÑO(COD_DICIPLINA_PARTIC)
);
GO
CREATE TABLE  BD_CARRERA_DANIELbRICEÑO(
    COD_CARRERA_PARTICIPANTE CHAR(10) PRIMARY KEY,
    CARRERA_PARTICIPANTE VARCHAR(100)
);
GO


CREATE TABLE  BD_DATOS_PARTICIPACION_DANIELbRICEÑO (
    COD_NOMBRE_PARTCIPANTE CHAR(10) PRIMARY KEY,
    NOMBRE_PARTCICIPANTE VARCHAR(100),
    COD_CARRERA_PARTICIPANTE CHAR(10),
    FOREIGN KEY (COD_CARRERA_PARTICIPANTE) REFERENCES BD_CARRERA_DANIELbRICEÑO(COD_CARRERA_PARTICIPANTE)
);
GO
CREATE TABLE  BD_DATOS_CORREO_AUSPICIADORES_DANIELbRICEÑO(
    COD_CORREO_AUSPICIADORES CHAR(10) PRIMARY KEY,
    CORREO_AUSPICIADORES VARCHAR(100)
);
GO


CREATE TABLE  BD_AUSPICIADORES_DANIELbRICEÑO(
    COD_BOLETA CHAR(10),
    COD_NOMBRE_AUSPICIADORES CHAR(10),
    NOMBRE_AUSPICIADORES VARCHAR(100),
    COD_CORREO_AUSPICIADORES CHAR(10),
    INVERSIONES DECIMAL(10, 2),
    PRIMARY KEY (COD_BOLETA, COD_NOMBRE_AUSPICIADORES),
    FOREIGN KEY (COD_CORREO_AUSPICIADORES) REFERENCES BD_DATOS_CORREO_AUSPICIADORES_DANIELbRICEÑO(COD_CORREO_AUSPICIADORES)
);
GO


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT*FROM BD_LIGA_DANIELbRICEÑO
CREATE OR ALTER PROCEDURE InsertarLiga
    @COD_LIGA CHAR(10),
    @LIGA VARCHAR(100)
AS
BEGIN
    INSERT INTO BD_LIGA_DANIELbRICEÑO (COD_LIGA, LIGA)
    VALUES (@COD_LIGA, @LIGA);
END;
GO

EXEC InsertarLiga 1234567890,'LIGA1'
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CREATE OR ALTER PROCEDURE ActualizarLiga
    @COD_LIGA CHAR(10),
    @NUEVO_COD_LIGA CHAR(10),
    @NUEVA_LIGA VARCHAR(100)
AS
BEGIN
    UPDATE BD_LIGA_DANIELbRICEÑO
    SET COD_LIGA = @NUEVO_COD_LIGA,
        LIGA = @NUEVA_LIGA
    WHERE COD_LIGA = @COD_LIGA;
END;
GO

EXEC ActualizarLiga 1234567890 , 1234567899,LIGAmAYOR
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


CREATE PROCEDURE EliminarLiga
    @COD_LIGA CHAR(10)
AS
BEGIN
    DELETE FROM BD_LIGA_DANIELbRICEÑO
    WHERE COD_LIGA = @COD_LIGA;
END;
GO

EXEC EliminarLiga 1234567899


USE TorneosDB;
GO
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT*FROM BD_LIGA_DANIELbRICEÑO
----------
CREATE PROCEDURE ConsultarDatos
    @COD_LIGA CHAR(10),
    @FECHA DATE
AS
BEGIN
    SELECT T.COD_BOLETA, T.FECHA, T.NOMBRE_ORGANIZADOR, T.CELULAR, T.CORREO,
           P.COD_NOMBRE_PARTCIPANTE, P.CARRERA_PARTICIPANTE, P.MEDALLAS_GANADAS,
           D.DICIPLINA_PARTICIPANTE,
           A.NOMBRE_AUSPICIADORES, A.INVERSIONES
    FROM BD_TORNEO_DANIELbRICEÑO T
    INNER JOIN BD_PARTICIPANTES_DANIELbRICEÑO P ON T.COD_BOLETA = P.COD_BOLETA
    INNER JOIN BD_DICIPLINA_DANIELbRICEÑO D ON P.COD_DICIPLINA_PARTIC = D.COD_DICIPLINA_PARTIC
    INNER JOIN BD_AUSPICIADORES_DANIELbRICEÑO A ON T.COD_BOLETA = A.COD_BOLETA
    WHERE T.COD_LIGA = @COD_LIGA
      AND T.FECHA > @FECHA;
END;
GO

EXEC ConsultarDatos 1234567891 ,'2020-12-11'


--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SELECT*FROM BD_LIGA_DANIELbRICEÑO


CREATE PROCEDURE ConsultarEstadisticas
    @COD_LIGA CHAR(10)
AS
BEGIN
    SELECT
        T.COD_BOLETA,
        COUNT(P.COD_NOMBRE_PARTCIPANTE) AS TotalParticipantes,
        SUM(P.MEDALLAS_GANADAS) AS TotalMedallas
    FROM
        BD_TORNEO_DANIELbRICEÑO T
    INNER JOIN
        BD_PARTICIPANTES_DANIELbRICEÑO P ON T.COD_BOLETA = P.COD_BOLETA
    WHERE
        T.COD_LIGA = @COD_LIGA
    GROUP BY
        T.COD_BOLETA
    HAVING
        COUNT(P.COD_NOMBRE_PARTCIPANTE) > 5;
END;

EXEC ConsultarEstadisticas 1234567891